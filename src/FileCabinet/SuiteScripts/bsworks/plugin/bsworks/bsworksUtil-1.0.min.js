define(["N/record","N/search","N/https","N/http","N/url","N/format","N/runtime","N/ui/dialog","N/ui/message","../util/md5"],(e,t,l,a,n,i,s,r,o,u)=>{const d=e=>null===e||""===e||" "===e||void 0===e,c={SESSION_SUITELET_CONFIG:"bsworks_suitelet_form_config",client:{LAODING_MASK_ID:"custom_mask",LOADING_MESSAGE_ID:"bsworks_loading_message",LOADING_MASK_IMG_URL:"https://7336086.app.netsuite.com/core/media/media.nl?id=28692&c=7336086&h=Xq73GtcFjvOXxvafAbgoQcjgS3AXq1xJxZTSpEeBW10uzNKe"},suitelet:{SUBLIST_ID:"custpage_subitem_list",SUBLIST_TYPE:{LIST:"LIST",INLINEEDITOR:"INLINEEDITOR"},SUBLIST_CHECKBOX:"sublist_checkbox",SUBLIST_LINE_NUM:"sublist_line_num",FILTER_BUTTON_CONFIG:[{id:"custpage_button_search",label:"查&nbsp;&nbsp;询",primary:!0,style:null},{id:"custpage_button_reset",label:"重&nbsp;&nbsp;置",primary:!1,style:null},{id:"custpage_button_exportexcel",label:"&nbsp;&nbsp;导出EXCEL&nbsp;&nbsp;",primary:!1,style:null}]},ac:["1346c1adb8c85962dd0c9cbdb6aadba0","e0968ebe717427bb5feb52a22335c11e"]},p={trim:e=>d(e)?"":e.replace(/(^\s*)|(\s*$)/g,""),getNultistageName:(e,t,l)=>{d(t)&&(t=" : "),d(l)&&(l=-1);var a=e.split(t);if(a.length>1){if(l>=0&&a.length>l)return a[l];if(l<0&&a.length+l>0)return a.reverse(),a[Math.abs(l-1)]}return a},toLowerCase:e=>d(e)?e:e.toLowerCase(),toUpperCase:e=>d(e)?e:e.toUpperCase()},m={decimalPlaces:2,toFixed:(e,t)=>{if(d(e))return 0;t=parseInt(t)||0,0==t&&(t=m.decimalPlaces),e=e.toFixed(parseInt(t));let l=m.decimalPlaces;if(t>m.decimalPlaces){const a=(e+"").split(".");let n=a[1];for(let e=t-1;e>=m.decimalPlaces;e--){if(parseInt(n.substring(e))>0){l=e+1;break}n=n.substring(0,e)}e=a[0]+"."+n}return parseFloat(e).toFixed(l)},numberThousandsFormat:(e,t,l,a,n)=>{e=(e+"").replace(/[^0-9+-Ee.]/g,""),n=n||"ceil";var i=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):0,r=void 0===a?",":a,o=void 0===l?".":l,u="",d=function(e,t){var l=Math.pow(10,t);return""+parseFloat(Math[n](parseFloat((e*l).toFixed(2*t))).toFixed(2*t))/l};u=(s?d(i,s):""+Math.round(i)).split(".");for(var c=/(-?\d+)(\d{3})/;c.test(u[0]);)u[0]=u[0].replace(c,"$1"+r+"$2");return(u[1]||"").length<s&&(u[1]=u[1]||"",u[1]+=new Array(s-u[1].length+1).join("0")),u.join(o)}},f={stringToDate:e=>d(e)?"":i.parse({value:e,type:"date"}),dateToString:e=>d(e)?"":i.format({value:e,type:"date"}),getCurrentTimezoneStr:()=>i.format({value:new Date,type:i.Type.DATETIME,timezone:i.Timezone.ASIA_HONG_KONG}),getCurrentTimezoneDate(){const e=f.getCurrentTimezoneStr();return i.parse({value:e,type:i.Type.DATE})},getCurrentDate:(e,t,l,a)=>{const n=f.getCurrentTimezoneDate();d(t)||n.setFullYear(n.getFullYear()+t),d(l)||n.setMonth(n.getMonth()+l),d(a)||n.setDate(n.getDate()+a);var i=n.getFullYear(),s=n.getMonth()+1;parseInt(s)<10&&(s="0"+s);var r=n.getDate();parseInt(r)<10&&(r="0"+r),d(e)&&(e="-");var o=i+e+s+e+r;return o},getFilterRangeDate:(e,t)=>d(e)&&d(t)?[]:(d(e)&&(e="2000-01-01"),d(t)&&(t="2050-01-01"),[e,t]),getFirstAndEndtDayInCurrent:e=>{e||(e=i.format({value:new Date,type:i.Type.DATE,timezone:i.Timezone.ASIA_HONG_KONG}));let t=i.parse({value:e,type:i.Type.DATE,timezone:i.Timezone.ASIA_HONG_KONG});t.getDate()>1&&t.setDate(1),t.getDate()>1&&t.setDate(1);let l=new Date(t);return l.setMonth(t.getMonth()+1),l.setDate(0),t=i.format({value:t,type:"date"}),l=i.format({value:l,type:"date"}),[t,l]}},g={isNullOrEmpty:e=>e instanceof Array&&0==e.length||(e instanceof Object&&0==Object.keys(e)||d(e)),isObject:e=>e instanceof Array||e instanceof Object,removeEmptyKey:e=>{const t={};for(const l in e)d(e[l])||(t[l]=e[l]);return t}},y={get:e=>{const t=a.get({url:e});return JSON.parse(t.body)},post:(e,t)=>{const l=a.post({url:e,body:t,headers:{Accept:"*/*","Content-Type":"application/json;charset=UTF-8"}});return JSON.parse(l.body)},postHeader:(e,t,l)=>{const n=a.post({url:e,body:t,headers:{Accept:"*/*","Content-Type":"application/json;charset=UTF-8",...l}});return JSON.parse(n.body)}},h={post:(e,t,a)=>{const n=l.post({url:h.getSuiteletUrl(e),body:h.getRequestBody(t,a),headers:{Accept:"*/*","Content-Type":"application/json;charset=UTF-8"}});return JSON.parse(n.body)},postUrl:(e,t,a)=>{const n=l.post({url:e,body:h.getRequestBody(t,a),headers:{Accept:"*/*","Content-Type":"application/json;charset=UTF-8"}});return JSON.parse(n.body)},getResolveDomainUrl:()=>"https://"+n.resolveDomain({hostType:n.HostType.APPLICATION}),getSuiteletUrl:e=>n.resolveScript({scriptId:"customscript_"+e,deploymentId:"customdeploy_"+e}),getRequestBody:(e,t)=>{const l={type:e,data:t};return JSON.stringify(l)},getResponseObject:(e,t,l)=>(d(e)&&(e="success"),d(t)&&(t="操作成功"),d(l)&&(l={}),{status:e,message:t,data:l}),getSuccessResponse:(e,t)=>(d(e)&&(e="操作成功"),d(t)&&(t={}),{status:"success",message:e,data:t}),getFailResponse:(e,t)=>({status:"fail",message:e,data:t}),setSessionValue:(e,t)=>{!d(t)&&g.isObject(t)&&(t=JSON.stringify(t)),s.getCurrentSession().set({name:e,value:t})},getSessionValue:(e,t)=>{let l=s.getCurrentSession().get({name:e});return!d(l)&&t&&(l=JSON.parse(l)),l}},b={create:(t,l,a,n)=>{const i={};[e.Type.SALES_ORDER].includes(p.toLowerCase(t))&&(i.entity=l.mainData.entity);const s=e.create({type:t,isDynamic:!0,defaultValues:i}),r=l.mainData,o=l.dateFields,u=l.excludeFields;for(const e in r){let t=r[e];d(t)||(null!=u&&u.includes(e)||(null!=o&&o.includes(e)&&(t=f.stringToDate(t)),s.setValue({fieldId:e,value:t})))}const c=l.sublistData;for(const e in c){const t=c[e];s.selectNewLine({sublistId:e}),t.forEach(t=>{for(const l in t){let a=t[l];d(a)||(["inventoryDetail"].includes(key)||null!=u&&u.includes(l)||(null!=o&&o.includes(l)&&(a=f.stringToDate(a)),s.setCurrentSublistValue({sublistId:e,fieldId:l,value:a})))}if(null!=t.inventoryDetail&&t.inventoryDetail.length>0){const l=s.getCurrentSublistSubrecord({sublistId:e,fieldId:"inventorydetail"});t.inventoryDetail.forEach((t,a)=>{0==a&&(s.setCurrentSublistValue({sublistId:e,fieldId:"custcol_amt_bin_name",value:t.binnumber_name}),s.setCurrentSublistValue({sublistId:e,fieldId:"custcol_amt_lotnumber",value:t.inventorynumber})),l.selectNewLine({sublistId:"inventoryassignment"}),d(t.binnumber)||l.setCurrentSublistValue({sublistId:"inventoryassignment",fieldId:"binnumber",value:t.binnumber}),l.setCurrentSublistValue({sublistId:"inventoryassignment",fieldId:"inventorystatus",value:"1"}),l.setCurrentSublistValue({sublistId:"inventoryassignment",fieldId:"receiptinventorynumber",value:t.inventorynumber}),l.setCurrentSublistValue({sublistId:"inventoryassignment",fieldId:"quantity",value:t.quantity}),l.commitLine({sublistId:"inventoryassignment"})})}s.commitLine({sublistId:"item"})})}let m=0;return!1!==a&&(null!=n&&0!=Object.keys(n).length||(n={enableSourcing:!1,ignoreMandatoryFields:!0}),m=s.save(n)),m}},S={button:{getHtml:e=>{let t="margin-top:25px;height:30px;min-width:60px;font-family: Open Sans,Helvetica,sans-serif;font-size: 14px !important;font-weight: 600;cursor: pointer; border-radius:3px;";e.primary?t+="background: #0297f5 !important;border-color: #125ab2 !important;color:white !important;":t+="margin-left:35px;background: #fafafa !important;border-color:#b2b2b2 !important;",d(e.style)||(t+=e.style);var l='<input type="button" style="'+t+'"  value="'+e.label+'" id="'+e.id+'" name="'+e.id+'" ';return e.primary?l+="onmouseover=\"this.style.backgroundColor='#125ab2';\" onmouseout=\"this.style.backgroundColor='#0297f5';\" ":l+="onmouseover=\"this.style.backgroundColor='#e5e5e5';\" onmouseout=\"this.style.background='#fafafa';\" ",l+="/>",l},setPrimary:e=>{const t=';document.getElementById("'+e+'").style= document.getElementById("'+e+'").style + ";background: #0297f5 !important; height:26.2px !important;color:white !important;";';return t}},field:{layout:(e,t)=>{if(d(t))return"";g.isNullOrEmpty(e)&&(e={});const l=d(e.colNum)?4:e.colNum,a=!!d(e.lastColRight)||e.lastColRight;var n=";var colNum="+l+",lastColRight="+a+',filterFieldsObj=document.getElementById("tr_fg_'+t+'"),filterChildNodes=filterFieldsObj.childNodes;filterFieldsObj.removeChild(filterChildNodes[0]),filterFieldsObj.removeChild(filterChildNodes[filterChildNodes.length-1]);var fieldLength=filterChildNodes.length,rowNum=parseInt(fieldLength/colNum);fieldLength%colNum==0&&rowNum--;for(var index=0,r=1;r<=rowNum&&filterChildNodes.length!=colNum;r++){var newTr=document.createElement("tr");newTr.id = "'+t+'_tr_" + r;newTr.className="uir-fieldgroup-content";for(var i=0;i<colNum;i++){if(lastColRight&&filterChildNodes.length==colNum+1)for(var x=0;x<colNum-(i+1);x++){var emptyTd=document.createElement("td");emptyTd.id="'+t+'_td_" + r + "_" + x;newTr.append(emptyTd)}filterChildNodes.length>colNum&&newTr.append(filterChildNodes[colNum])}filterFieldsObj.parentElement.append(newTr)}';return n}},sublist:{notHeaderSort:e=>{const t=";var "+e+'Header=document.getElementById("'+e+'header");if(null!='+e+"Header)for(var children="+e+'Header.children,i=0;i<children.length;i++)children[i].removeAttribute("onclick");';return t},addSummaryContent:(e,t,l)=>{let a=".uir-list-control-bar";t==c.suitelet.SUBLIST_TYPE.INLINEEDITOR&&(a=".uir-listheader-button-row");const n=';jQuery("#'+e+"_layer "+a+'")'+(t==c.suitelet.SUBLIST_TYPE.INLINEEDITOR?'.append("<td>")':"")+".append(\"<div id='"+e+"Bar' style='position: absolute;right: 30px;top: 13px;font-weight: bold;font-size: 14px;color: #3d3d3d;'>"+l+'</div>")'+(t==c.suitelet.SUBLIST_TYPE.INLINEEDITOR?'.append("</td>")':"")+";";return n}}},v={getRequestParamters:(e,t)=>{const l=!(!d(e.pageInit)&&"true"!=e.pageInit);return e.pageInit=l,l?e.defaultValues=t:(t=JSON.parse(e.defaultValues),null!=t.custpage_filter_start_date&&null!=t.custpage_filter_end_date&&(t.custpage_filter_date=f.getFilterRangeDate(t.custpage_filter_start_date,t.custpage_filter_end_date)),e.defaultValues=t,null!=t.custpage_page_index&&(e.pageIndex=t.custpage_page_index),null!=t.custpage_page_size&&(e.pageSize=t.custpage_page_size)),e},form:{customPageScript:"",create:(e,t,l,a)=>{const n=d(t.title)?"自定义表单":t.title,i=!d(t.hideNavBar)&&t.hideNavBar,s=e.createForm({title:n,hideNavBar:i});null==t.scriptConfig||d(t.scriptConfig.clientScriptModuleName)||(s.clientScriptModulePath=t.scriptConfig.scriptModulePath+t.scriptConfig.clientScriptModuleName+".js"),v.form.customPageScript+=d(t.customPageScript)?"":t.customPageScript,null!=t.fieldGroupConfig&&t.fieldGroupConfig.length>0&&t.fieldGroupConfig.forEach(t=>{v.form.fieldGroup.create(e,s,t,l),v.form.customPageScript+=S.field.layout(t.layoutConfig,t.id)});const r={};let o="";if(null!=t.sublistConfig&&t.sublistConfig.length>0&&t.sublistConfig.forEach(t=>{o=t.id;const l=null==a||null==a[t.id]?[]:a[t.id],n=v.form.sublist.create(e,s,t,l);r[t.id]=n}),!d(v.form.customPageScript)){let t={id:"custpage_page_script",label:" ",type:e.FieldType.INLINEHTML};d(o)||(t.container=o),s.addField(t).defaultValue='<script type="text/javascript">(function () {'+v.form.customPageScript+"}());</script>"}return h.setSessionValue(c.SESSION_SUITELET_CONFIG,t),{form:s,sublists:r}},fieldGroup:{create:(e,t,l,a)=>{const n=l.id,i=l.isFilterGroup;d(n)||(d(l.label)&&(l.label=i?"过滤器":"自定义字段组"),t.addFieldGroup({id:l.id,label:l.label})),null!=l.fields&&l.fields.length>0&&(l.fields.forEach(l=>{v.form.field.create(e,t,l,n)}),g.isNullOrEmpty(a)||t.updateDefaultValues(a));let s="";if(i&&null!=l.buttons&&0==l.buttons.length){const e=c.suitelet.FILTER_BUTTON_CONFIG;e.forEach(e=>{s+=S.button.getHtml(e)})}else l.buttons.forEach(e=>{s+=S.button.getHtml(e)});if(!d(s)){const l=d(n)?"custpage_field_button"+s.length:n+"_button";let a={id:l,label:" ",type:e.FieldType.INLINEHTML};d(n)||(a.container=n),t.addField(a).updateBreakType({breakType:e.FieldBreakType.STARTCOL}).defaultValue=s}}},field:{create:(e,t,l,a)=>{let n=l.id;d(l.alias)||(n=l.alias);let i=l.type;d(i)&&(i="text");var s={id:n,label:l.label,type:i};d(a)||(s.container=a),d(l.source)||(s.source=l.source);var r=t.addField(s);if("inlinehtml"!=i||d(l.defaultValue)||(r.defaultValue=l.defaultValue),d(l.displayType)||r.updateDisplayType({displayType:l.displayType}),r.updateBreakType({breakType:e.FieldBreakType.STARTCOL}),d(l.source)&&null!=l.selectOptions){const e=l.selectOptions;e.length>0&&((null==l.showEmptyItem||l.showEmptyItem)&&r.addSelectOption({value:"",text:"-全部-"}),e.forEach(e=>{r.addSelectOption(e)}))}}},sublist:{create:(e,t,l,a)=>{const n=d(l.type)?e.SublistType.LIST:l.type,i=t.addSublist({id:l.id,type:n,label:l.label});n==e.SublistType.LIST&&null!=l.addMarkAllButtons&&l.addMarkAllButtons&&i.addMarkAllButtons(),(null==l.hasCheckbox||l.hasCheckbox)&&i.addField({id:c.suitelet.SUBLIST_CHECKBOX,type:"checkbox",label:"选择"});var s=i.addField({id:c.suitelet.SUBLIST_LINE_NUM,type:"integer",label:"序号"});if(n==e.SublistType.INLINEEDITOR&&s.updateDisplayType({displayType:"disabled"}),l.fields.forEach(e=>{v.form.sublist.addField(i,n,e)}),null!=l.buttons&&l.buttons.forEach(e=>{v.form.sublist.addButton(i,e)}),null==l.hasHeaderSort||l.hasHeaderSort||(v.form.customPageScript+=S.sublist.notHeaderSort(l.id)),null!=l.hasSummary&&l.hasSummary){const e=v.form.sublist.getSummaryContent(l,a);v.form.customPageScript+=S.sublist.addSummaryContent(l.id,n,e)}return null!=a&&v.form.sublist.addData(i,a),i},addField:(e,t,l)=>{const a=d(l.displayType)?"inline":l.displayType;if("none"==a)return;const n=d(l.alias)?l.id:l.alias,i=d(l.type)?"text":l.type,s={id:n,label:l.label,type:i};"select"!=i||d(l.source)||(s.source=l.source);const r=e.addField(s);"select"==i&&d(l.source)&&null!=l.selectOptions&&(r.addSelectOption({value:"",text:"-全部-"}),l.selectOptions.forEach(e=>{r.addSelectOption({value:e.value,text:e.text})})),"list"==t.toLowerCase()&&"disabled"==a?r.updateDisplayType({displayType:"entry"}).updateDisplayType({displayType:a}):r.updateDisplayType({displayType:a}),null!=l.displaySize&&r.updateDisplaySize(l.displaySize)},addButton:(e,t)=>{e.addButton({id:t.id,label:t.label}),t.primary&&(v.form.customPageScript+=S.button.setPrimary(t.id))},getSummaryContent:(e,t)=>{function l(e,t){let l=[];return null==t||0==t.length?l:(e.forEach(e=>{if(null!=e.summary&&(null==e.summary.display||e.summary.display)){const t=d(e.alias)?e.id:e.alias,a=d(e.summary.label)?e.label+"合计":e.summary.label;l.push({id:t,label:a})}}),0==l.length?l:(l=l.map(e=>{let l=!1,a=0,n=0;return t.forEach(t=>{l=!!t.sublist_checkbox,d(t[e.id])||(a=parseFloat(a)+parseFloat(t[e.id]),l&&(n=parseFloat(n)+parseFloat(t[e.id])))}),a=a.toFixed(2),n=n.toFixed(2),e.totalSummary=a,e.selectedSummary=n,e.hasSelected=l,e}),l))}const a=e.fields,n=l(a,t);let i="";return n.forEach(e=>{let t=e.hasSelected?e.selectedSummary:e.totalSummary;t=m.numberThousandsFormat(t,2,".",","),i+="<span id='total_"+e.id+"' style='margin-left:30px;'>"+e.label+"："+t+"</span>"}),i},addData:(e,t)=>{null!=t&&0!=t.length&&t.forEach((t,l)=>{for(var a in t)if(a!=c.suitelet.SUBLIST_LINE_NUM){var n=t[a];d(n)||e.setSublistValue({id:a,value:n,line:l})}else e.setSublistValue({id:a,value:l+1,line:l})})}}}},I={beforeLoad:{addButtonEventListener:(e,t,l,a)=>{let n="";null!=l&&1!=l||(n+='var message="执行中，请稍后...",maskId="custom_mask",mask=document.createElement("div");mask.id=maskId,mask.style.display="none",mask.style.left="0px",mask.style.top="0px",mask.style.bottom="0px",mask.style.right="0px",mask.style.position="fixed",mask.style.zIndex=99999,mask.style.background="rgba(0,0,0,0.1)",mask.style.width="100%";var maskHeight=0;maskHeight=document.body.clientHeight&&document.documentElement.clientHeight?document.body.clientHeight<document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight:document.body.clientHeight>document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,mask.style.height=maskHeight+"px",mask.innerHTML="<div style=\'font-size:18px; text-align: center; line-height:"+maskHeight+"px; font-weight: bold;\'><img src=\''+c.client.LOADING_MASK_IMG_URL+'\'/>"+message+"</div>",document.body.appendChild(mask);'),t.forEach(e=>{let t='var custscript_buttonId=document.getElementById("custscript_buttonId");custscript_buttonId.addEventListener("click",function(){custscript_buttonId.disabled=!0,document.getElementById("custom_mask").style.display="block"});';t=t.replace(/(custscript_buttonId)/g,e),n+=t}),null==a&&(a="custpage_button_event_field"),e.addField({id:a,type:"inlinehtml",label:"按钮监听脚本"}).defaultValue='<script type="text/javascript">(function () {'+n+"}());</script>"},removeViewSublistButton(e,t){try{var l='const intervalRemoveBtnObj=setInterval(function(){if(NS.form.isInited()&&NS.form.isValid()){try{const t="#bsworks_sublistIds#",e=t.split(",");for(let t=0;t<e.length;t++){const n=e[t];new MutationObserver(t=>{for(let e of t)if("childList"===e.type){console.log("removeViewSublistButton",n+"子元素发生了变化");const t=jQuery("#"+n+"__div").find("#"+n+"__tab").find(".uir-list-row-tr");for(let e=0;e<t.length;e++)t[e].firstElementChild.innerHTML="",t[e].lastElementChild.innerHTML=""}}).observe(document.getElementById(n+"__div"),{childList:!0})}}catch(t){console.log(t)}clearInterval(intervalRemoveBtnObj)}},500);';const a=t.join(",");l=l.replace(/#bsworks_sublistIds#/g,a),e.addField({id:"custpage_remove_view_sublist_button",type:"inlinehtml",label:"移除子页签查看页操作按钮"}).defaultValue='<script type="text/javascript">(function () {'+l+"}());</script>"}catch(e){log.error({title:"removeSublistButton error",details:e})}}},beforeSubmit:{deleteSublist:t=>{const l=e.load({type:t.type,id:t.id,isDynamic:!0}),a=l.getSublists(),n=[];if(a.forEach(e=>{0==e.indexOf("recmachcustrecord")&&n.push(e)}),n.length>0){let e=!1;n.forEach(t=>{const a=l.getLineCount({sublistId:t});if(a>0){e=!0;for(let e=a-1;e>=0;e--)l.removeLine({sublistId:t,line:e})}}),e&&l.save({ignoreMandatoryFields:!0})}}}},_={pageInit:e=>{const t=h.getSessionValue(c.SESSION_SUITELET_CONFIG,!0);return _.mask.createLoadingMask(),_.listener.filterButtonListener(e,t),_.listener.sublistButtonListener(e,t),t},listener:{filterButtonListener:(e,t)=>{if(null==t)return;let l=[],a=t.fieldGroupConfig.find(e=>e.isFilterGroup);null!=a&&(l=null!=a.buttons&&0==a.buttons.length?c.suitelet.FILTER_BUTTON_CONFIG:a.buttons),null!=l&&l.length>0&&(a.suiteletScriptName=null==t.scriptConfig?null:t.scriptConfig.suiteletScriptName,l.forEach(l=>{if(null==l.addEventListener||l.addEventListener){const n=document.getElementById(l.id);n.addEventListener("click",function(){n.disabled=!0,document.getElementById(c.client.LAODING_MASK_ID).style.display="block",setTimeout(function(){"custpage_button_search"==n.id?_.event.doSearch(e,n.id,a):"custpage_button_reset"==n.id?_.event.doReset(e,n.id,a):"custpage_button_exportexcel"==n.id&&_.event.doExportExcel(e,n.id,t.title,t.sublistConfig[0])},100)})}}))},sublistButtonListener:(e,t)=>{null!=t&&t.sublistConfig.forEach(t=>{let l=t.buttons;if(null!=l&&l.length>0){const a=t.id;l.forEach(t=>{if(t.addEventListener){const l=t.id,n=document.getElementById(l);n.addEventListener("click",function(){n.disabled=!0,document.getElementById(c.client.LAODING_MASK_ID).style.display="block",setTimeout(function(){"custpage_button_checked_all"==l&&_.event.sublistCheckedAll(e,a,c.suitelet.SUBLIST_CHECKBOX,l,"全  选","取消全选")},100)})}})}})}},event:{doSearch:(e,t,l)=>{try{for(var a=e.currentRecord,n=l.fields,i=0;i<n.length;i++){var s=n[i];if(null!=s.required&&s.required){var o=a.getValue(s.id);if(d(o))return void r.alert({title:"提示",message:"过滤器 - "+s.label+"不能为空！"})}}_.event.doSearchSuitelet(a,l,!1)}catch(e){console.log(e),r.alert({title:"错误提示",message:e.message})}finally{_.mask.clearLoadingMask(t)}},doReset:(e,t,l,a)=>{try{var n=e.currentRecord;_.event.doSearchSuitelet(n,l,!0)}catch(e){console.log(e),r.alert({title:"错误提示",message:e.message})}finally{_.mask.clearLoadingMask(t)}},doSearchSuitelet:(e,t,l)=>{setWindowChanged(window,!1);var a=_.event.geSearchParameters(e,t.fields,l),i=n.resolveScript({scriptId:"customscript_"+t.suiteletScriptName,deploymentId:"customdeploy_"+t.suiteletScriptName,params:a});window.location.href="https://"+n.resolveDomain({hostType:n.HostType.APPLICATION})+i},geSearchParameters:(e,t,l)=>{let a={pageInit:l},n={};for(var i=0;i<t.length;i++){const a=t[i];if("inlinehtml"==a.type)continue;let s=d(a.defaultValue)?"":a.defaultValue;const r=a.id;l||(s=e.getValue(a.id),"date"==a.type&&(s=e.getText(a.id)),null!=a.type&&"select"==a.type&&(n[r+"_display_name"]=e.getText(a.id))),n[r]=s}return a.defaultValues=JSON.stringify(n),a},sublistCheckedAll(e,t,l,a,n,i){const s=document.getElementById(a);var o=!0;-1!=s.value.indexOf(i)&&(o=!1);try{var u=e.currentRecord,d=u.getLineCount({sublistId:t});if(0==d)return;for(var c=0;c<d;c++)u.selectLine({sublistId:t,line:c}),u.setCurrentSublistValue({sublistId:t,fieldId:l,value:o});u.commitLine({sublistId:t}),s.value=o?i:n}catch(e){console.log(e),r.alert({title:"错误提示",message:e.message})}finally{_.mask.clearLoadingMask(a)}},doExportExcel:(e,t,l,a,n)=>{try{for(var i="序号",s=[],o={},u=a.fields,p=0;p<u.length;p++){var m=u[p];let e=d(m.displayType)?"inline":m.displayType;if(null!=m.excel&&null!=m.excel.displayType&&(e=m.excel.displayType),"hidden"==e)continue;const t=d(m.alias)?m.id:m.alias,l=d(m.type)?null:m.type;null==l||"float"!=l&&"integer"!=l&&"currency"!=l||(o[t]=0);let a=m.label;null==m.excel||d(m.excel.label)||(a=m.excel.label),i+=","+a;var f={id:t,type:l,displayType:e,excel:m.excel};s.push(f)}i+="\n",null==n&&(n=_.sublist.getSublistDatalist(e,s,a.id,!0));var g="";for(p=0;p<n.length;p++){var y=n[p];for(var h in y)if(h!=c.suitelet.SUBLIST_CHECKBOX){var b=y[h];if(null!=o[h]?(d(b)&&(b=0),o[h]=parseFloat(o[h])+parseFloat(b)):(-1!=(b+"").indexOf(",")&&(b='"'+b+'"'),"boolean"==typeof b&&(b=b?"是":"否")),i+=b+",",p==n.length-1)if(h==c.suitelet.SUBLIST_LINE_NUM)g+="合计,";else if(null!=o[h]){var S=o[h];S=S.toFixed(2),g+=S+","}else g+=","}i+="\n"}i+=g+"\n";var v="data:text/csv;charset=utf-8,\ufeff"+encodeURIComponent(i),I=document.createElement("a");I.href=v,I.download=l+".csv",I.click()}catch(e){console.log(e),r.alert({title:"错误提示",message:e.message})}finally{_.mask.clearLoadingMask(t)}}},sublist:{getSublistDatalist:(e,t,l,a,n)=>{var i=e.currentRecord;d(l)&&(l=c.suitelet.SUBLIST_ID);var s=[],r=[],o=i.getLineCount({sublistId:l});if(0==o)return s;for(var u=0;u<o;u++){var p={};p[c.suitelet.SUBLIST_LINE_NUM]=u+1;var m=i.getSublistValue({sublistId:l,fieldId:c.suitelet.SUBLIST_CHECKBOX,line:u});if(d(m)&&(m=!1),null==n||!n||m){p[c.suitelet.SUBLIST_CHECKBOX]=m;for(var f=0;f<t.length;f++){var g=t[f];const e=d(g.alias)?g.id:g.alias;let n="";if(null!=g.type&&"date"==g.type)n=i.getSublistText({sublistId:l,fieldId:e,line:u});else if(null==g.type||"select"!=g.type||null==g.displayType||"entry"!=g.displayType&&"disabled"!=g.displayType)n=i.getSublistValue({sublistId:l,fieldId:e,line:u});else if(a)n=i.getSublistText({sublistId:l,fieldId:e,line:u});else{n=i.getSublistValue({sublistId:l,fieldId:e,line:u});const t=i.getSublistText({sublistId:l,fieldId:e,line:u});p[e+"_display_name"]=t}if(a&&null!=g.excel){var y=g.excel;d(y.valuePrefix)||(n=y.valuePrefix+n),d(y.valueSuffix)||(n+=y.valueSuffix)}p[e]=n}s.push(p),m&&r.push(p)}}return 0==r.length?s:r},showSublistSummary:(e,t)=>{const l=_.sublist.getSublistDatalist(e,t.fields,t.id,!1);console.log("subDataList",l);const a=v.form.sublist.getSummaryContent(t,l);jQuery("#"+t.id+"Bar").html(a)}},mask:{createLoadingMask:e=>{function t(){let e=0;return e=document.body.clientHeight&&document.documentElement.clientHeight?document.body.clientHeight<document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight:document.body.clientHeight>document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,e}let l="执行中，请稍后...",a=c.client.LAODING_MASK_ID;if(null!=e&&null!=e.message&&(l=e.message),null!=e&&null!=e.maskId&&(a=e.maskId),document.getElementById(a))document.getElementById(a).style.display="block";else{var n=document.createElement("div");n.id=a,n.style.display="none",n.style.left="0px",n.style.top="0px",n.style.bottom="0px",n.style.right="0px",n.style.position="fixed",n.style.zIndex=99999,n.style.background="rgba(0,0,0,0.1)",n.style.width="100%";var i=t();n.style.height=i+"px",n.innerHTML="<div style='font-size:18px; text-align: center; line-height:"+i+"px; font-weight: bold;'><img src='"+c.client.LOADING_MASK_IMG_URL+"'/><span id='"+c.client.LOADING_MESSAGE_ID+"'>"+l+"<span></div>",document.body.appendChild(n)}},showLoadingMask:(e,t)=>{if(d(e))return;d(t)&&(t=c.client.LAODING_MASK_ID);const l=document.getElementById(e);l.disabled=!0,document.getElementById(t).style.display="block"},clearLoadingMask:(e,t)=>{if(!d(e)){const t=document.getElementById(e);null!=typeof t&&(t.disabled=!1)}d(t)&&(t=c.client.LAODING_MASK_ID),document.getElementById(t)&&(document.getElementById(t).style.display="none")}}},T={searchDataList:(e,t)=>{function l(e,t){const l=[{id:"item",label:"货品",filter:{operator:"anyof",values:t.items}},{id:"location",label:"仓库",filter:{operator:"anyof",values:t.locations}},{id:"binnumber",label:"库位",filter:{operator:"anyof",values:t.binnumbers}},{id:"inventorynumber",label:"批次号"},{id:"available",label:"可用量"},{id:"onhand",label:"现有量"},{id:"stockunit",label:"库存单位",join:"item",search:{type:"valueText"}}],a=T.getSearchAllResultDataList(e,l,1,1e3);return a}function a(e,t){const l=[{id:"isinactive",filter:{values:"F"}},{id:"internalid",label:"内部id"},{id:"name",label:"名称"},{id:"subsidiary",label:"子公司",filter:{operator:"anyof",values:t.subsidiarys}}],a=T.getSearchAllResultDataList(e,l,1,1e3);return a}let n=[];return"inventorybalance"==e?n=l(e,t):"location"==e&&(n=a(e,t)),n},getSearchAllResultDataList:(e,t,l,a,n)=>{parseInt(l)>1&&(l=1),0==(parseFloat(n)||0)&&(n=10);let i=T.getSearchResultDataList(e,t,l,a);if(1e3==i.length)for(var s=0;s<parseInt(n);s++){l++;var r=T.getSearchResultDataList(e,t,l,a);if(i=i.concat(r),r.length<1e3)break}return i},getSearchResultDataList:(e,t,l,a)=>{const n=[];try{const r=T.getSearchResult(e,t,l,a);if(0==r.length)return n;for(var i=0;i<r.length;i++){const e=r[i];let l={};l[c.suitelet.SUBLIST_LINE_NUM]=i+1;for(var s=0;s<t.length;s++){const a=T.getSearchFieldConfig(t[s]),n=a.searchType;if("none"==n){null!=a.defaultValue&&(l[a.name]=a.defaultValue);continue}let i={name:a.id};null!=a.searchSummary&&(i.summary=a.searchSummary),null!=a.searchFormula&&(i.formula=a.searchFormula),null!=a.join&&(i.join=a.join);const r=a.name;let o=e.getValue(i);if("checkbox"==a.type&&(o="true"===o||!0===o?"T":"F"),!d(n))if("text"==n)o=e.getText(i);else if("valueText"==n){const t=r+"_display_name";l[t]=e.getText(i)}l[r]=o}n.push(l)}}catch(e){log.debug("执行getSearchResultDataList方法出错",e)}return n},getSearchResult:(e,l,a,n)=>{function i(e){const t=[];for(var l=0;l<e.length;l++){var a=T.getSearchFieldConfig(e[l]);if("none"!=a.searchType){var n={};n.name=a.id,null!=a.searchSort&&(n.sort=a.searchSort),null!=a.searchSummary&&(n.summary=a.searchSummary),null!=a.searchFormula&&(n.formula=a.searchFormula),null!=a.join&&(n.join=a.join),t.push(n)}}return t}function s(e){const t=[];for(var l=0;l<e.length;l++){const i=e[l];if(!d(i.filter)){var a=T.getSearchFieldConfig(i);if(!d(a.filterValues)||"isnotempty"==a.filterOperator||"isempty"==a.filterOperator){var n={name:a.id,operator:a.filterOperator};null!=a.filterName&&(n.name=a.filterName),null!=a.join&&(n.join=a.join),null!=a.searchFormula&&(n.formula=a.searchFormula),"isnotempty"!=a.filterOperator&&"isempty"!=a.filterOperator&&(n.values=a.filterValues),t.push(n)}}}return t}function r(e,l,a,n,i){const s=t.create({type:e,columns:l,filters:a});return s.run().getRange({start:n,end:i})}const o=s(l),u=i(l);(d(a)||parseInt(a)<1)&&(a=1),(d(n)||parseInt(n)>1e3)&&(n=1e3);var c=(parseInt(a)-1)*parseInt(n),p=parseInt(a)*parseInt(n);return r(e,u,o,c,p)},getSearchFieldConfig:e=>{const t=e.id,l=d(e.alias)?t:e.alias,a=d(e.join)?null:e.join;let n="value",i=null,s=null,r=null,o=null,u=null,c="is",p=null;if(!d(e.search)){const t=e.search;d(t.type)||(n=t.type),d(t.summary)||(i=t.summary),d(t.formula)||(s=t.formula),d(t.sort)||(r=t.sort),d(t.defaultValue)||(o=t.defaultValue)}if(!d(e.filter)){const t=e.filter;d(t.id)||(u=t.id),d(t.operator)||(c=t.operator),d(t.values)||t.values instanceof Array&&0==t.values.length||(p=t.values)}let m="text";d(e.type)||(m=e.type);let f="inline";return d(e.displayType)||(f=e.displayType),{id:t,name:l,type:m,displayType:f,join:a,searchType:n,searchSummary:i,searchFormula:s,searchSort:r,defaultValue:o,filterName:u,filterOperator:c,filterValues:p}}},E={getSearchAllResultDataList:(e,t,l,a,n)=>{parseInt(l)>1&&(l=1),0==(parseFloat(n)||0)&&(n=10);let i=E.getSearchResultDataList(e,t,l,a);if(1e3==i.length)for(var s=0;s<parseInt(n);s++){l++;var r=T.getSearchResultDataList(e,t,l,a);if(i=i.concat(r),r.length<1e3)break}return i},getSearchResultDataList:(e,l,a,n)=>{const i=[],s=t.load({id:e}),r=s.columns,o=s.filters;if(null!=l&&l.length>0){l.forEach(e=>{const t=E.getSearchColumn(r,e);t&&r.push(t)});const e=l.filter(e=>e.filter);for(let t=0;t<e.length;t++){const l=e[t],a=l.filter;(a.values||"isnotempty"==a.filterOperator||"isempty"==a.filterOperator)&&(a.name||(a.name=l.id),l.join&&(a.join=l.join),l.search&&l.search.formula&&(a.formula=l.search.formula),a.operator||(a.operator="is"),o.push(a))}}s.filters=o,s.columns=r,log.debug("searchColumns",{searchColumns:r,searchFilters:o});const u=s.run().getRange({start:a-1,end:n});if(0==u.length)return i;const d=[];return null!=l&&l.length>0&&l.forEach(e=>{e.search&&"valueText"==e.search.type&&d.push(e.id)}),u.forEach((e,t)=>{const l={sublist_line_num:t+1+""};r.forEach(a=>{let n=a.name;0==n.indexOf("formula")&&(n=n+""+t),l[n]=e.getValue(a),-1!=d.indexOf(n)&&(l[n+"_display_name"]=e.getText(a))}),i.push(l)}),i},getSearchColumn:(e,t)=>{let l=!1;if(t.search&&"none"==t.search.type)return null;for(var a=0;a<e.length;a++){let n=e[a].join;n&&(n=p.toLowerCase(n));let i=t.join;if(i&&(i=p.toLowerCase(i)),e[a].name==t.id&&n==i){l=!0;break}}if(l)return null;const n={name:t.id};return t.search&&(t.search.sort&&(n.sort=t.search.sort),t.search.summary&&(n.summary=t.search.summary),t.search.formula&&(n.formula=t.search.formula)),null!=t.join&&(n.join=t.join),n}},N={create:(e,t,l,a)=>{var n=e.create({taskType:t,scriptId:"customscript_"+l,deploymentId:"customdeploy_"+l,params:a});return n.submit()},reduce:{createReduceMessage:(e,t,l,a)=>{function n(){const e=h.post(l,"getReduceStatus",{taskId:a});if("fail"==e.status)r.alert({title:"提示",message:e.message});else{const l=e.data.taskStatus;var t="任务进行中";"COMPLETE"==l?t="任务处理成功":"FAILED"==l&&(t="任务处理失败"),r.alert({title:"提示",message:t})}}const i=o.create({title:e,message:"<div id='reduceMessageDiv' style='margin-top:10px;'>您操作的记录条数为<span id='reduceMessageSpan' style='font-weight:bold;'>"+t+"</span>条，已启用异步线程处理任务，任务执行期间<span style='font-weight:bold;'>请勿操作当前页面</span>，点击<a id='reduceScheduleA' style='font-weight:bold;text-decoration:underline;cursor: pointer;' >此处</a>查询任务进度<div>",type:o.Type.CONFIRMATION});return i.show(),setTimeout(function(){document.querySelector("#div__alert").scrollIntoView(!0)},100),setTimeout(function(){var e=document.getElementById("reduceScheduleA");e&&e.addEventListener("click",function(){setTimeout(function(){n()},100)})},1e3),i},getReduceStatus:(e,t)=>{let l=h.getSuccessResponse();try{var a=e.checkStatus(t),n=a.status;l.data={taskStatus:n}}catch(e){log.debug("getReduceStatus",e),l.status="fail",l.message=e.message}return l}}},L={accountId:()=>s.accountId};try{if(-1==c.ac.indexOf(u.hex_md5(L.accountId())))return}catch(e){}return{isNullOrEmpty:d,constant:c,string:p,number:m,date:f,object:g,https:h,http:y,record:b,suitelet:v,userEvent:I,client:_,search:T,savedSearch:E,task:N,runtime:L,customHtmlScript:S}});